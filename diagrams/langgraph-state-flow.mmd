flowchart LR
    start([START]) --> assess[assess_risk]
    assess --> decide[decide_route]
    decide --> emit[emit_decision]
    emit --> finish([END])

    start_state["State at START\n- event\n- trace_id\n- trace: []"]
    assess_state["State after assess_risk\n- assessment: predicted_altitude_ft, ceiling_ft, risk_score, confidence (LLM-derived)\n- trace += assess_risk"]
    decide_state["State after decide_route\n- llm_decision: route, should_alert, rationale\n- assessment.route, assessment.should_alert\n- trace += decide_route"]
    emit_state["State after emit_decision\n- decision: status, message, route, risk_score, confidence\n- trace += emit_decision"]

    start -.-> start_state
    assess -.-> assess_state
    decide -.-> decide_state
    emit -.-> emit_state
